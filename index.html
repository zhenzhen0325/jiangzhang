<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‘©â€ğŸ« è£èª‰æ—¶åˆ» - æ²‰æµ¸å¼å¥–çŠ¶ç”Ÿæˆå™¨</title>
    <style>
        :root {
            --primary-color: #d32f2f; /* å¥–çŠ¶çº¢ */
            --accent-color: #fbc02d; /* é‡‘è‰² */
            --bg-color: #f5f5f5;
            --card-bg: #ffffff;
            --text-main: #333333;
        }

        body {
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            background-image: radial-gradient(#e0e0e0 1px, transparent 1px);
            background-size: 20px 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: var(--text-main);
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            width: 90%;
            max-width: 1200px;
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
            animation: fadeIn 0.8s ease-out;
        }

        /* å·¦ä¾§æ§åˆ¶é¢æ¿ */
        .controls {
            flex: 1;
            min-width: 300px;
            padding: 40px;
            background: linear-gradient(135deg, #fff 0%, #fff9f9 100%);
            border-right: 1px solid #eee;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .controls h2 {
            margin-top: 0;
            color: var(--primary-color);
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        label {
            font-weight: bold;
            font-size: 14px;
            color: #666;
        }

        input, select, textarea {
            padding: 12px;
            border: 2px solid #eee;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
            font-family: inherit;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(211, 47, 47, 0.1);
        }

        .btn {
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            text-align: center;
        }

        .btn-download {
            background: var(--primary-color);
            color: white;
            margin-top: auto;
            box-shadow: 0 4px 15px rgba(211, 47, 47, 0.3);
        }

        .btn-download:hover {
            background: #b71c1c;
            transform: translateY(-2px);
        }

        .file-upload {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }

        /* å³ä¾§é¢„è§ˆåŒºåŸŸ */
        .preview {
            flex: 1.5;
            min-width: 350px;
            background-color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
            background-image: url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23444" fill-opacity="0.4"%3E%3Cpath d="M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');
        }

        canvas {
            max-width: 100%;
            height: auto;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            border-radius: 4px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                margin: 20px 0;
            }
            .preview {
                min-height: 300px;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="controls">
        <h2>ğŸ† å¥–çŠ¶ç”ŸæˆåŠ©æ‰‹</h2>
        
        <div class="form-group">
            <label>1. ç¡®è®¤å¥–çŠ¶åº•å›¾</label>
            <input type="file" id="bgInput" accept="image/*">
            <span class="file-upload">å¦‚æœé¢„è§ˆåŒºä¸ºç©ºï¼Œè¯·å…ˆç‚¹å‡»è¿™é‡Œä¸Šä¼ ä½ æä¾›çš„"å¥–çŠ¶.jpg"</span>
        </div>

        <div class="form-group">
            <label>2. è·å¥–å­¦ç”Ÿå§“å</label>
            <input type="text" id="studentName" placeholder="ä¾‹å¦‚ï¼šå¼ ä¸‰" value="å¼ ä¸‰">
        </div>

        <div class="form-group">
            <label>3. å¥–é¡¹å†…å®¹ / è¯„è¯­</label>
            <textarea id="awardContent" rows="3" placeholder="ä¾‹å¦‚ï¼šåœ¨æœ¬æ¬¡æœŸæœ«è€ƒè¯•ä¸­ï¼Œæ•°å­¦æˆç»©ä¼˜å¼‚ï¼Œè£è·â€œæ•°å­¦å°æ ‡å…µâ€ç§°å·ã€‚">åœ¨æœ¬æ¬¡æœŸæœ«è€ƒè¯•ä¸­ï¼Œæˆç»©ä¼˜å¼‚ï¼Œè¡¨ç°çªå‡ºï¼Œç‰¹å‘æ­¤çŠ¶ï¼Œä»¥èµ„é¼“åŠ±ã€‚</textarea>
            <select id="quickSelect" onchange="fillContent(this.value)" style="margin-top:5px; font-size: 14px; color: #555;">
                <option value="">âœ¨ å¿«é€Ÿé€‰æ‹©å¸¸ç”¨è¯­...</option>
                <option value="è£è·â€œæ•°å­¦ä¼˜èƒœå¥–â€ï¼Œå¸Œæœ›å†æ¥å†å‰ï¼">æ•°å­¦ä¼˜èƒœå¥–</option>
                <option value="è£è·â€œè¯­æ–‡è¿›æ­¥ä¹‹æ˜Ÿâ€ï¼Œä»˜å‡ºç»ˆæœ‰å›æŠ¥ï¼">è¯­æ–‡è¿›æ­¥å¥–</option>
                <option value="è£è·â€œè‹±è¯­å•è¯å°è¾¾äººâ€ç§°å·ï¼">è‹±è¯­å•è¯è¾¾äºº</option>
                <option value="ä¹äºåŠ©äººï¼Œå“å¾·ä¼˜è‰¯ï¼Œè£è·â€œç¾å¾·å°‘å¹´â€ç§°å·ã€‚">ç¾å¾·å°‘å¹´</option>
            </select>
        </div>

        <div class="form-group" style="flex-direction: row; gap: 20px;">
            <div style="flex:1">
                <label>4. é¢å‘æœºæ„/è€å¸ˆ</label>
                <input type="text" id="issuer" value="ç­ä¸»ä»»ï¼šç‹è€å¸ˆ">
            </div>
            <div style="flex:1">
                <label>5. æ—¥æœŸ</label>
                <input type="date" id="dateInput">
            </div>
        </div>

        <button class="btn btn-download" onclick="downloadImage()">â¬‡ï¸ ç¡®è®¤å¹¶ä¸‹è½½å¥–çŠ¶</button>
    </div>

    <div class="preview">
        <canvas id="awardCanvas"></canvas>
    </div>
</div>

<script>
    const canvas = document.getElementById('awardCanvas');
    const ctx = canvas.getContext('2d');
    
    // è¾“å…¥å…ƒç´ 
    const nameInput = document.getElementById('studentName');
    const contentInput = document.getElementById('awardContent');
    const issuerInput = document.getElementById('issuer');
    const dateInput = document.getElementById('dateInput');
    const bgInput = document.getElementById('bgInput');

    // åˆå§‹åŒ–æ—¥æœŸä¸ºä»Šå¤©
    dateInput.valueAsDate = new Date();

    // å›¾ç‰‡å¯¹è±¡
    let bgImage = new Image();
    
    // é»˜è®¤åŠ è½½é€»è¾‘ (å¦‚æœå›¾ç‰‡åœ¨åŒç›®å½•ä¸‹ï¼Œå¯ä»¥ä¿®æ”¹è¿™é‡Œ)
    // å¦‚æœæ²¡æœ‰æœ¬åœ°å›¾ç‰‡ï¼Œé¡µé¢åŠ è½½æ—¶ä¼šæ˜¾ç¤ºä¸ºç©ºï¼Œéœ€è¦ç”¨æˆ·ä¸Šä¼ 
    bgImage.src = ''; 
    
    bgImage.onload = () => {
        drawAward();
    };

    // ç›‘å¬æ‰€æœ‰è¾“å…¥æ¡†çš„å˜åŒ–ï¼Œå®ç°å®æ—¶é¢„è§ˆ
    [nameInput, contentInput, issuerInput, dateInput].forEach(input => {
        input.addEventListener('input', drawAward);
    });

    // ç›‘å¬èƒŒæ™¯å›¾ä¸Šä¼ 
    bgInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                bgImage.src = event.target.result;
            }
            reader.readAsDataURL(file);
        }
    });

    // å¿«é€Ÿå¡«è¯åŠŸèƒ½
    window.fillContent = function(val) {
        if(val) {
            contentInput.value = val;
            drawAward();
        }
    }

    // æ ¸å¿ƒç»˜åˆ¶å‡½æ•°
    function drawAward() {
        if (!bgImage.src) return;

        // 1. è®¾ç½®ç”»å¸ƒå¤§å°ä¸ºå›¾ç‰‡åŸå§‹å¤§å°
        canvas.width = bgImage.naturalWidth;
        canvas.height = bgImage.naturalHeight;

        // 2. ç»˜åˆ¶èƒŒæ™¯å›¾
        ctx.drawImage(bgImage, 0, 0);

        // 3. é…ç½®é€šç”¨å­—ä½“æ ·å¼ (é»‘ä½“, åŠ ç²—)
        // æ³¨æ„ï¼šå­—ä½“å¤§å°æ˜¯æ ¹æ®å›¾ç‰‡åˆ†è¾¨ç‡ä¼°ç®—çš„ï¼Œå¦‚æœå›¾ç‰‡å¾ˆå¤§ï¼Œæ–‡å­—ä¼šå˜å°ï¼ŒæŒ‰æ¯”ä¾‹è°ƒæ•´
        const baseSize = canvas.width * 0.04; // åŸºå‡†å­—å·
        ctx.fillStyle = '#000000'; // çº¯é»‘
        ctx.textBaseline = 'middle';

        // --- ç»˜åˆ¶åå­— (æ­å–œ xxx åŒå­¦) ---
        ctx.font = `bold ${baseSize * 1.5}px "SimHei", "STHeiti", sans-serif`;
        ctx.textAlign = 'center';
        // åå­—ä½ç½®ï¼šæ°´å¹³å±…ä¸­ï¼Œå‚ç›´æ–¹å‘å¤§æ¦‚åœ¨å›¾ç‰‡çš„ 35% å¤„
        const nameY = canvas.height * 0.38; 
        ctx.fillText(`æ­å–œ ${nameInput.value} åŒå­¦`, canvas.width / 2, nameY);

        // --- ç»˜åˆ¶å¥–çŠ¶å†…å®¹ ---
        ctx.font = `bold ${baseSize}px "SimHei", "STHeiti", sans-serif`;
        ctx.textAlign = 'left'; 
        
        // è‡ªåŠ¨æ¢è¡Œé€»è¾‘
        const contentText = contentInput.value;
        const startX = canvas.width * 0.18; // å·¦è¾¹è· 18%
        const startY = canvas.height * 0.52; // èµ·å§‹é«˜åº¦ 52%
        const maxWidth = canvas.width * 0.64; // æ–‡æœ¬æœ€å¤§å®½åº¦
        const lineHeight = baseSize * 1.6;

        wrapText(ctx, contentText, startX, startY, maxWidth, lineHeight);

        // --- ç»˜åˆ¶è½æ¬¾å’Œæ—¥æœŸ ---
        ctx.font = `bold ${baseSize * 0.8}px "SimHei", "STHeiti", sans-serif`;
        ctx.textAlign = 'right';
        const footerX = canvas.width * 0.85; // å³è¾¹è·
        const footerY = canvas.height * 0.80; // åº•éƒ¨é«˜åº¦

        // è½æ¬¾
        ctx.fillText(issuerInput.value, footerX, footerY);
        
        // æ—¥æœŸ
        const dateObj = new Date(dateInput.value);
        const dateStr = `${dateObj.getFullYear()}å¹´${dateObj.getMonth() + 1}æœˆ${dateObj.getDate()}æ—¥`;
        ctx.fillText(dateStr, footerX, footerY + lineHeight);
    }

    // è‡ªåŠ¨æ¢è¡Œè¾…åŠ©å‡½æ•°
    function wrapText(context, text, x, y, maxWidth, lineHeight) {
        let words = text.split('');
        let line = '';

        for(let n = 0; n < words.length; n++) {
            let testLine = line + words[n];
            let metrics = context.measureText(testLine);
            let testWidth = metrics.width;
            if (testWidth > maxWidth && n > 0) {
                context.fillText(line, x, y);
                line = words[n];
                y += lineHeight;
            } else {
                line = testLine;
            }
        }
        context.fillText(line, x, y);
    }

    // ä¸‹è½½åŠŸèƒ½
    window.downloadImage = function() {
        if (!bgImage.src) {
            alert('è¯·å…ˆä¸Šä¼ å¥–çŠ¶èƒŒæ™¯å›¾ï¼');
            return;
        }
        const link = document.createElement('a');
        link.download = `${nameInput.value}_å¥–çŠ¶.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();
    }
</script>

</body>
</html>